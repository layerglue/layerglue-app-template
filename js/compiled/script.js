$(function(){Access.notificationCentre=new Layerglue.core.NotificationCentre,Access.router=new App.router.AppRouter}),function(){Layerglue.createLazyObjectHierarchy("App.constants"),App.constants.PageConstants={PRELOADER:"page-preloader",HOME:"page-home"}}(),function(){Layerglue.createLazyObjectHierarchy("App.router"),App.router.AppRouter=Layerglue.route.BaseRouter.extend({initialize:function(){Layerglue.route.BaseRouter.prototype.initialize(),Access.siteView=new App.views.SiteView({el:$("body")}),Access.loadManager.addPreloadableAsset(new Layerglue.io.ImageLoader({id:"shared",path:"/images/shared-sprites.png"})),this.addRoute(App.constants.PageConstants.PRELOADER,App.views.pages.PreloaderPageView,"preloader"),this.addRoute(App.constants.PageConstants.HOME,App.views.pages.HomePageView,""),Access.notificationCentre.on(Layerglue.constants.SystemEvents.PRELOADER_COMPLETE,_.bind(this.onPreloaderComplete,this)),this.showPage(App.constants.PageConstants.PRELOADER,{data:Access.loadManager.loader}),Access.loadManager.start()},onPreloaderComplete:function(){Backbone.history.start()}})}(),function(){Layerglue.createLazyObjectHierarchy("App.views"),App.views.SiteView=Layerglue.views.BaseView.extend({initialize:function(){Layerglue.views.BaseView.prototype.initialize.call(this)}})}(),function(){Layerglue.createLazyObjectHierarchy("App.views.controls"),App.views.controls.ProgressBar=Layerglue.views.BaseView.extend({initialize:function(){this.$el.append('<div class="bar"></div>'),this.bar=this.$el.find(".bar"),this.barMinWidth=0,Layerglue.views.BaseView.prototype.initialize.call(this)},onAddedToDOM:function(){this.barMaxWidth=this.$el.width(),this.bar.css({width:this.barMinWidth})},setValue:function(a,b){var c=(this.barMaxWidth-this.barMinWidth)*a+this.barMinWidth;isNaN(b)||b===0?this.bar.css({width:c}):this.bar.animate({width:c},{duration:b,complete:_.bind(this.onAnimationComplete,this)})},calculateValue:function(){return(this.bar.width()-this.barMinWidth)/(this.barMaxWidth-this.barMinWidth)},onAnimationComplete:function(){this.trigger("animationComplete")}})}(),function(){Layerglue.createLazyObjectHierarchy("App.views.pages"),App.views.pages.PreloaderPageViewModes={SKIP_ANIM_IF_CACHED:"skipAnimIfCached",ALWAYS_PLAY_ANIM:"alwaysPlayAnim"},App.views.pages.PreloaderPageView=Layerglue.views.BasePageView.extend({id:App.constants.PageConstants.PRELOADER,className:"page",mode:App.views.pages.PreloaderPageViewModes.ALWAYS_PLAY_ANIM,initialize:function(){Layerglue.views.BasePageView.prototype.initialize.call(this),this.loadIsComplete=!1,this.cacheCheckDuration=100,this.animationDuration=500,this.model.data.on("itemLoadComplete",_.bind(this.onLoadItemComplete,this)),this.model.data.on("loadComplete",_.bind(this.onLoadComplete,this)),this.minDurationComplete=!1,this.render(),this.mode===App.views.pages.PreloaderPageViewModes.SKIP_ANIM_IF_CACHED?_.defer(_.bind(this.startCacheCheckTimeout,this)):_.defer(_.bind(this.updateProgress,this)),this.setupInitialAppearance()},onAddedToDOM:function(){this.progressBar=this.addChild(new App.views.controls.ProgressBar({el:this.$el.find(".progress-bar-wrapper")})),this.progressBar.on("animationComplete",_.bind(this.onProgressBarAnimationComplete,this))},startCacheCheckTimeout:function(){this.cacheCheckTimeout=setTimeout(_.bind(this.onCacheCheckTimeout,this),this.cacheCheckDuration)},onCacheCheckTimeout:function(){this.model.getProgress()===1?Access.notificationCentre.trigger(Layerglue.constants.SystemEvents.PRELOADER_COMPLETE):this.updateProgress()},startProgressCheckTimeout:function(){this.progressCheckTimeout=setTimeout(_.bind(this.onProgressCheckTimeout,this),this.animationDuration)},updateProgress:function(){this.progressBar.setValue(this.model.data.getProgress(),this.animationDuration)},onProgressBarAnimationComplete:function(){this.progressBar.calculateValue()===1?Access.notificationCentre.trigger(Layerglue.constants.SystemEvents.PRELOADER_COMPLETE):this.updateProgress()},onLoadItemComplete:function(a){},onLoadComplete:function(){},render:function(){return this.populateTemplate(),this}})}(),function(){Layerglue.createLazyObjectHierarchy("App.views.pages"),App.views.pages.HomePageView=Layerglue.views.BasePageView.extend({id:App.constants.PageConstants.HOME,className:"page",initialize:function(){Layerglue.views.BasePageView.prototype.initialize.call(this)}})}();