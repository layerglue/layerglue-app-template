(function(){Layerglue={},Access={},Layerglue.createLazyObjectHierarchy=function(a){var b=a.split("."),c,d,e,f=[];for(var g=0;g<b.length;g++)g===0?c=window:c=d,e=b[g],d=c[e],d||(c[e]=d={}),f.push(d);return f}})(),function(a){a.fn.extend({isChildOf:function(a){return this.closest(a).length>0},hasChild:function(b){return a(b).closest(this).length>0},isInDOM:function(){return this.closest("html").length>0}})}($),function(){Layerglue.createLazyObjectHierarchy("Layerglue.io"),Layerglue.io.LoadEvents={ITEM_COMPLETE:"itemComplete",ITEM_ERROR:"itemError",COMPLETE:"complete",ERROR:"error"}}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.io"),Layerglue.io.ImageLoader=Backbone.Model.extend({defaults:{path:null,id:null,complete:!1},initialize:function(a){_.extend(this,Backbone.Events),this.path=a.path,this.id=a.id},start:function(){var a=new Image,b=this;a.addEventListener("load",function(){b.complete=!0,b.trigger(Layerglue.io.LoadEvents.COMPLETE,b)},!1),a.addEventListener("error",function(){b.complete=!0,b.trigger(Layerglue.io.LoadEvents.ERROR,b)},!1),a.src=this.path}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.io"),Layerglue.io.JSONLoader=Backbone.Model.extend({defaults:{path:null,id:null,complete:!1},initialize:function(a){_.extend(this,Backbone.Events),this.path=a.path,this.id=a.id,this.params=a.params},start:function(){var a=this;$.ajax({url:this.path,dataType:"json",data:this.params,success:function(){a.complete=!0,a.trigger(Layerglue.io.LoadEvents.COMPLETE),console.log("JSONsLoader.complete: "+a.path)},error:function(){a.trigger(Layerglue.io.LoadEvents.ERROR)}})}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.io"),Layerglue.io.MultiLoader=Backbone.Model.extend({initialize:function(){this.id=null,this.successCount=0,this.errorCount=0,this.cache={},this.items=[],this.complete=!1},addItem:function(a){this.items.push(a),a.on(Layerglue.io.LoadEvents.COMPLETE,_.bind(this.onItemComplete,this)),a.on(Layerglue.io.LoadEvents.ERROR,_.bind(this.onItemError,this)),a.on(Layerglue.io.LoadEvents.ITEM_ERROR,_.bind(this.onItemError,this))},start:function(){this.loadNextItem()},loadNextItem:function(){if(this.getProgress()===1)this.complete=!0,this.trigger(Layerglue.io.LoadEvents.COMPLETE);else for(var a=0;a<this.items.length;a++){var b=this.items[a];if(!b.complete){b.start();break}}},onItemComplete:function(a){this.trigger(Layerglue.io.LoadEvents.ITEM_COMPLETE,a),this.loadNextItem()},onItemError:function(a){console.log("MultiLoader.onItemError: "+a.path),console.log("multiloader error ",this),this.trigger(Layerglue.io.LoadEvents.ITEM_ERROR,a),this.loadNextItem()},getAsset:function(a){return this.cache[a]},getProgress:function(){if(this.items.length===0)return 1;var a=0;for(var b=0;b<this.items.length;b++)this.items[b].complete&&a++;return a/this.items.length},getNumItems:function(){return this.items.length},isComplete:function(){return this.queue.length===this.successCount+this.errorCount}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.io"),Layerglue.io.LoadManager=Backbone.Model.extend({initialize:function(a){this.initialLoadComplete=!1,this.setupItems=[],this.loader=new Layerglue.io.MultiLoader,this.loader.on(Layerglue.io.LoadEvents.ITEM_COMPLETE,this.onItemComplete),this.loader.on(Layerglue.io.LoadEvents.ITEM_ERROR,this.onItemError)},start:function(){this.loader.start()},addDefaultPreloadableAssetForPage:function(a){this.addPreloadableAsset(new Layerglue.io.ImageLoader({id:a,path:"images/pages/"+a+".png"}))},addPreloadableAsset:function(a){this.loader.addItem(a)},onItemComplete:function(a){},onItemError:function(a){}}),Access.loadManager=new Layerglue.io.LoadManager}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.math"),Layerglue.math.MathUtils={},Layerglue.math.MathUtils.clamp=function(a,b,c){return Math.max(b,Math.min(c,a))},Layerglue.math.MathUtils.cube=function(a){return a*a*a},Layerglue.math.MathUtils.round=function(a,b){var c=Math.round(a*Math.pow(10,b))/Math.pow(10,b);return c}}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.string"),Layerglue.string.StringUtils={},Layerglue.string.StringUtils.trim=function(a){return a.replace(/^\s+|\s+$/g,"")}}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.core"),Layerglue.core.NotificationCentre=Backbone.Model.extend({initialize:function(){}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.constants"),Layerglue.constants.SystemEvents={PRELOADER_COMPLETE:"PRELOADER_COMPLETE",PAGE_TRANSITION_IN_START:"PAGE_TRANSITION_IN_START",PENDING_PAGE_CHANGE:"PENDING_PAGE_CHANGE"}}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.sequencer"),Layerglue.sequencer.SequencerEvents={COMPLETE:"complete",ITEM_COMPLETE:"itemComplete",TRANSITION_IN_START:"transitionInStart",TRANSITION_IN_COMPLETE:"transitionInComplete",TRANSITION_OUT_START:"transitionOutStart",TRANSITION_OUT_COMPLETE:"transitionOutComplete"}}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.sequencer"),Layerglue.sequencer.SequencerStates={PAUSED_START:"pausedAtStart",PAUSED_MID:"pausedMid",PAUSED_END:"pausedAtEnd",PLAYING_FORWARDS:"playingForwards",PLAYING_BACKWARDS:"playingBackwards"}}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.sequencer");var a=Layerglue.sequencer.SequencerStates,b=Layerglue.sequencer.SequencerEvents;Layerglue.sequencer.AnimationSequencerItem=Backbone.Model.extend({object:null,endValues:null,options:{},startValues:null,state:null,delayTimout:null,initialize:function(b,c,d){this.object=b,this.endValues=c,this.options=d,this.options._complete=this.options.complete,this.options.complete=_.bind(this.onComplete,this),this.state=a.PAUSED_START},playForwards:function(){clearTimeout(this.delayTimeout);if(this.state===a.PAUSED_START||this.state===a.PAUSED_MID||this.state===a.PLAYING_BACKWARDS)this.options.delay?this.delayTimeout=setTimeout(_.bind(this._playForwards,this),this.options.delay):this._playForwards()},_playForwards:function(){this.state===a.PAUSED_START&&this.startValues===null&&this.populateStartValues(),this.pause(),this.object.animate(this.endValues,this.options),this.state=a.PLAYING_FORWARDS},playBackwards:function(){clearTimeout(this.delayTimeout);if(this.state===a.PAUSED_END||this.state===a.PAUSED_MID||this.state===a.PLAYING_FORWARDS)this.options.delay?this.delayTimeout=setTimeout(_.bind(this._playBackwards,this),this.options.delay):this._playBackwards()},_playBackwards:function(){this.pause(),this.object.animate(this.startValues,this.options),this.state=a.PLAYING_BACKWARDS},pause:function(){clearTimeout(this.delayTimeout),this.object.stop(),this.state=a.PAUSED_MID},rewind:function(){clearTimeout(this.delayTimeout);if(this.state!==a.PAUSED_START){this.pause();for(var b in this.startValues)b==="rotate"?this.object.rotate(this.getSafeDegrees(this.startValues[b])):this.object.css(b,this.startValues[b]);this.state=a.PAUSED_START}},fastForward:function(){clearTimeout(this.delayTimeout);if(this.state!==a.PAUSED_END){this.state===a.PAUSED_START&&this.startValues===null&&this.populateStartValues(),this.pause();var b=this.endValues;for(var c in this.endValues)c==="rotate"?this.object.rotate(this.getSafeDegrees(this.endValues[c])):this.object.css(c,Number(this.endValues[c]));this.state=a.PAUSED_END}},onComplete:function(){this.state===a.PLAYING_BACKWARDS?this.state=a.PAUSED_START:this.state=a.PAUSED_END,this.options._complete&&this.options._complete(),this.trigger(b.COMPLETE)},populateStartValues:function(){this.startValues={};for(var a in this.endValues)a==="rotate"?this.startValues[a]=this.getRotation():a==="scale"?this.startValues[a]=this.getScale():this.startValues[a]=this.object.css(a)},getTransformMatrix:function(){return this.object.css("-webkit-transform")||this.object.css("-moz-transform")||this.object.css("-ms-transform")||this.object.css("-o-transform")||this.object.css("transform")||null},getRotation:function(){var a=0,b=this.getTransformMatrix();if(b&&b!=="none"){var c=b.split("(")[1].split(")")[0].split(","),d=c[0],e=c[1],f=c[2],g=c[3];a=Math.round(Math.atan2(e,d)*(180/Math.PI))}return a},getScale:function(){var a=0,b=this.getTransformMatrix(),c=1;if(b&&b!=="none"){var d=b.split("(")[1].split(")")[0].split(","),e=d[0],f=d[1],g=d[2],h=d[3];c=Math.sqrt(e*e+f*f)}return c},getSafeDegrees:function(a){return a&&isNaN(a)&&a.substring(a.length-3,a.length)==="deg"?Number(a.substring(0,a.length-3)):Number(a)},destroy:function(){}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.sequencer");var a=Layerglue.sequencer.SequencerEvents,b=Layerglue.sequencer.SequencerStates;Layerglue.sequencer.ParallelSequencer=Backbone.Model.extend({completedItemsIncrementer:NaN,initialize:function(a){this.items=[],this.completedItemsIncrementer=0,this.index=0,this.state=b.PAUSED_START;if(a)for(var c=0;c<a.length;c++){var d=a[c];this.addItem(d)}},addItem:function(a){var b=this;a.on("complete",_.bind(function(){this.onItemComplete(a)},this)),this.items.push(a)},playForwards:function(){if(this.state===b.PAUSED_START||this.state===b.PAUSED_MID||this.state===b.PLAYING_BACKWARDS){this.completedItemsIncrementer=0;for(var a=0;a<this.items.length;a++)this.items[a].playForwards();this.state=b.PLAYING_FORWARDS}},playBackwards:function(){if(this.state===b.PAUSED_END||this.state===b.PAUSED_MID||this.state===b.PLAYING_FORWARDS){this.completedItemsIncrementer=0;for(var a=0;a<this.items.length;a++)this.items[a].playBackwards();this.state=b.PLAYING_BACKWARDS}},pause:function(){if(this.state===b.PLAYING_FORWARDS||this.state===b.PLAYING_BACKWARDS){this.state=b.PAUSED_MID;for(var a=0;a<this.items.length;a++)this.items[a].pause()}},rewind:function(){if(this.state!==b.PAUSED_START){this.pause();for(var a=0;a<this.items.length;a++)this.items[a].state!==b.PAUSED_START&&this.items[a].rewind();this.completedItemsIncrementer=0,this.state=b.PAUSED_START}},fastForward:function(){if(this.state!==b.PAUSED_END){this.pause();for(var a=this.index;a<this.items.length;a++)this.items[a].state!==b.PAUSED_END&&this.items[a].fastForward();this.completedItemsIncrementer=this.items.length-1,this.state=b.PAUSED_END}},onItemComplete:function(a){this.trigger("itemComplete"),this.completedItemsIncrementer++,this.completedItemsIncrementer>=this.items.length&&(this.state===b.PLAYING_BACKWARDS?this.state=b.PAUSED_START:this.state=b.PAUSED_END,this.trigger("complete"))},destroy:function(){}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.sequencer");var a=Layerglue.sequencer.SequencerEvents,b=Layerglue.sequencer.SequencerStates;Layerglue.sequencer.SeriesSequencer=Backbone.Model.extend({index:null,initialize:function(a){this.items=[],this.index=0,this.state=b.PAUSED_START;if(a)for(var c=0;c<a.length;c++){var d=a[c];this.addItem(d)}},addItem:function(b){var c=this;b.on(a.COMPLETE,function(){c.onItemComplete(b)}),this.items.push(b)},playForwards:function(){if(this.state===b.PAUSED_START||this.state===b.PAUSED_MID||this.state===b.PLAYING_BACKWARDS)this.state===b.PLAYING_BACKWARDS&&this.pause(),this.state=b.PLAYING_FORWARDS,this.getActiveItem().playForwards()},playBackwards:function(){if(this.state===b.PAUSED_END||this.state===b.PAUSED_MID||this.state===b.PLAYING_FORWARDS)this.state===b.PLAYING_FORWARDS&&this.pause(),this.state=b.PLAYING_BACKWARDS,this.getActiveItem().playBackwards()},pause:function(){if(this.state===b.PLAYING_FORWARDS||this.state===b.PLAYING_BACKWARDS){var a=this.getActiveItem();a&&a.pause(),this.state=b.PAUSED_MID}},rewind:function(){if(this.state!==b.PAUSED_START){this.pause();for(var a=this.index;a>=0;a--)this.items[a].state!==b.PAUSED_START&&this.items[a].rewind();this.index=0,this.state=b.PAUSED_START}},fastForward:function(){if(this.state!==b.PAUSED_END){this.pause();for(var a=this.index;a<this.items.length;a++)this.items[a].state!==b.PAUSED_END&&this.items[a].fastForward();this.index=this.items.length-1,this.state=b.PAUSED_END}},next:function(){this.index<this.items.length-1?(this.index++,this.getActiveItem().playForwards()):(this.state=b.PAUSED_END,this.trigger(a.COMPLETE))},previous:function(){this.index>0?(this.index--,this.getActiveItem().playBackwards()):(this.state=b.PAUSED_START,this.trigger(a.COMPLETE))},getActiveItem:function(){return this.items[this.index]},onItemComplete:function(c){this.trigger(a.ITEM_COMPLETE),this.state===b.PLAYING_BACKWARDS?this.previous():this.next()},destroy:function(){}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.views"),Layerglue.views.BaseView=Backbone.View.extend({initialize:function(){_.extend(this,Backbone.SequencerEvents),this.children=[]},render:function(){return this},_onAddedToDOM:function(){this.onAddedToDOM()},onAddedToDOM:function(){},checkAddedToDOM:function(){this.isInDOM()&&(this._onAddedToDOM(),_.each(this.children,function(a){a._onAddedToDOM()}))},invalidate:function(a){a?_.defer(_.bind(this.update,this)):this.update()},update:function(){},appendToElement:function(a){a.append(this.el),this.checkAddedToDOM()},isInDOM:function(){return this.$el.closest("html").length>0},addChild:function(a){return this.children.push(a),a},removeChild:function(a){return this.children.splice(this.children.indexOf(a),1)[0]}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.views"),Layerglue.views.TransitionStates={SHOWN:"shown",HIDDEN:"hidden",SHOWING:"showing",HIDING:"hiding"};var a=Layerglue.sequencer.SequencerEvents,b=Layerglue.sequencer.SequencerStates,c=Layerglue.views.TransitionStates;Layerglue.views.TransitionableView=Layerglue.views.BaseView.extend({hasDualTransitions:!0,initialize:function(){Layerglue.views.BaseView.prototype.initialize.call(this),this.state=c.HIDDEN},setupInitialAppearance:function(){this.$el.css({opacity:0})},setupMonoTransition:function(){this.transition=this.createMonoTransition(),this.transition.on(a.COMPLETE,_.bind(this._onTransitionComplete,this))},destroyTransition:function(b){b&&(b.off(a.COMPLETE),b.destroy(),b=null)},_onTransitionComplete:function(){this.transition.state==b.PAUSED_END?(this.trigger(a.TRANSITION_IN_COMPLETE),this.onTransitionInComplete()):this.transition.state==b.PAUSED_START?(this.trigger(a.TRANSITION_OUT_COMPLETE),this.onTransitionOutComplete()):console.log("Error: Got to end of transition and not in PAUSED_END or PAUSED_START state.")},_onTransitionInComplete:function(){this.state=c.SHOWN,this.trigger(a.TRANSITION_IN_COMPLETE),this.onTransitionInComplete()},_onTransitionOutComplete:function(){this.state=c.HIDDEN,this.trigger(a.TRANSITION_OUT_COMPLETE),this.onTransitionOutComplete()},_startTransitionIn:function(b){this.state=c.SHOWING,this.onTransitionInStart(),this.trigger(a.TRANSITION_IN_START),this.destroyTransition(this.transitionIn),this.setupInitialAppearance(),this.transitionIn=this.createTransitionIn(),b?(this.transitionIn.fastForward(),this._onTransitionInComplete()):(this.transitionIn.on(a.COMPLETE,_.bind(this._onTransitionInComplete,this)),this.transitionIn.playForwards())},_startTransitionOut:function(b){this.state=c.HIDING,this.onTransitionOutStart(),this.trigger(a.TRANSITION_OUT_START),this.destroyTransition(this.transitionOut),this.transitionOut=this.createTransitionOut(),b?(this.transitionOut.fastForward(),this._onTransitionOutComplete()):(this.transitionOut.on(a.COMPLETE,_.bind(this._onTransitionOutComplete,this)),this.transitionOut.playForwards())},createMonoTransition:function(){return new Layerglue.sequencer.AnimationSequencerItem(this.$el,{opacity:"1"},{duration:600,easing:"easeInOutQuad"})},createTransitionIn:function(){return new Layerglue.sequencer.AnimationSequencerItem(this.$el,{opacity:"1"},{duration:600,easing:"easeInOutQuad"})},createTransitionOut:function(){return new Layerglue.sequencer.AnimationSequencerItem(this.$el,{opacity:"0"},{duration:600,easing:"easeInOutQuad"})},startTransitionIn:function(b){if(this.hasDualTransitions)this.state===c.HIDING?(this.transitionOut&&this.transitionOut.pause(),this._startTransitionIn(b)):this.state===c.HIDDEN?this._startTransitionIn(b):this.state!==c.SHOWING&&this.state!==c.SHOWN;else if(this.state===c.HIDING||this.state===c.HIDDEN)this.state=c.SHOWING,this.onTransitionInStart(),this.trigger(a.TRANSITION_IN_START),this.transition.playForwards()},startTransitionOut:function(b){if(this.hasDualTransitions)this.state===c.SHOWING?(this.transitionIn&&this.transitionIn.pause(),this._startTransitionOut(b)):this.state===c.SHOWN||this.state===undefined?this._startTransitionOut(b):this.state!==c.HIDING&&this.state!==c.HIDDEN;else if(this.state===c.SHOWING||this.state===c.SHOWN)this.state=c.HIDING,this.onTransitionOutStart(),this.trigger(a.TRANSITION_OUT_START),this.transition.playBackwards()},stopTransition:function(){this.transition.pause()},onRenderComplete:function(){},_onAddedToDOM:function(){this.onAddedToDOM()},onAddedToDOM:function(){this.hasDualTransitions||this.setupMonoTransition(),this.setupInitialAppearance()},attach:function(){this.$el.css({display:"block"})},detach:function(){this.$el.css({display:"none"})},onTransitionInStart:function(){},onTransitionInComplete:function(){},onTransitionOutStart:function(){},onTransitionOutComplete:function(){}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.views");var a=Layerglue.sequencer.SequencerEvents,b=Layerglue.sequencer.SequencerStates,c=Layerglue.views.TransitionStates;Layerglue.views.BasePageView=Layerglue.views.TransitionableView.extend({hasDualTransitions:!0,initialize:function(){Layerglue.views.TransitionableView.prototype.initialize.call(this),this.createTemplate(),this.createLoader(),this.render()},render:function(){return this.populateTemplate(),this},setModel:function(a){this.model=a},createLoader:function(){this.loader=[new Layerglue.io.ImageLoader({path:this.getDefaultImagePath()})]},getDefaultImagePath:function(){return"images/pages/"+this.id+".png"},createTemplate:function(){this.template=_.template($("#"+this.id+"-template").html())},populateTemplate:function(){this.model?this.$el.html(this.template(this.modelToJSON())):this.$el.html(this.template())},modelToJSON:function(){var a={};for(var b in this.model)this.model[b]&&this.model[b].toJSON?a[b]=this.model[b].toJSON():a[b]=this.model[b];return a},setupInitialAppearance:function(){this.$el.css({opacity:0})},_onAddedToDOM:function(){this.onAddedToDOM()},onAddedToDOM:function(){this.hasDualTransitions||this.setupMonoTransition(),this.setupInitialAppearance()},attach:function(){this.$el.css({display:"block"})},detach:function(){this.$el.css({display:"none"})}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.route"),Layerglue.route.Route=Backbone.Model.extend({id:null,pageClass:null,uri:null,handlerName:null,initialize:function(a,b,c,d){this.id=a,this.pageClass=b,this.uri=c,this.handlerName=d}})}(),function(){Layerglue.createLazyObjectHierarchy("Layerglue.route"),Layerglue.route.BaseRouter=Backbone.Router.extend({initialize:function(){this.isFirstPage=!0,this.pages={},this.complexRoutes=new Backbone.Collection,this.loadAllAssetsAtStartup=!0},addRoute:function(a,b,c,d){this.complexRoutes.push(new Layerglue.route.Route(a,b,c,d));var e=this;d?this.route(c,d):this.route(c,d,function(b){e.showPage(a,{query:b})})},getPage:function(a,b){var c=this.pages[a];if(c===undefined){var d=this.complexRoutes.get(a).pageClass;c=new d({model:b}),c.on(Layerglue.sequencer.SequencerEvents.TRANSITION_OUT_COMPLETE,_.bind(this.onPageTransitionOutComplete,this)),c.on(Layerglue.sequencer.SequencerEvents.TRANSITION_IN_COMPLETE,_.bind(this.onPageTransitionInComplete,this)),this.pages[a]=c}else c.setModel(b,1e3);return c},showPage:function(a,b){this.pendingPage=this.getPage(a,b),this.isFirstPage?(this.isFirstPage=!1,this._showPendingPage()):this.startTransitionOut(),Access.notificationCentre.trigger(Layerglue.constants.SystemEvents.PENDING_PAGE_CHANGE,this.pendingPage)},_showPendingPage:function(){this.pendingPage.isInDOM()||this.pendingPage.appendToElement($("#main")),this.currentPage=this.pendingPage,_.defer(_.bind(this.startTransitionIn,this)),Access.notificationCentre.trigger(Layerglue.constants.SystemEvents.PAGE_TRANSITION_IN_START,this.currentPage)},startTransitionIn:function(){this.currentPage.attach(),this.currentPage.startTransitionIn()},startTransitionOut:function(){this.currentPage.startTransitionOut()},onPageTransitionOutComplete:function(){this.currentPage.detach(),this._showPendingPage()},onPageTransitionInComplete:function(){}})}();